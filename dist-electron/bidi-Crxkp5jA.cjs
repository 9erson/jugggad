"use strict";var Gi=Object.create;var ns=Object.defineProperty;var Ki=Object.getOwnPropertyDescriptor;var Qi=Object.getOwnPropertyNames;var Xi=Object.getPrototypeOf,Yi=Object.prototype.hasOwnProperty;var Hs=i=>{throw TypeError(i)};var Zi=(i,e,t)=>e in i?ns(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var er=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Qi(e))!Yi.call(i,r)&&r!==t&&ns(i,r,{get:()=>e[r],enumerable:!(n=Ki(e,r))||n.enumerable});return i};var tr=(i,e,t)=>(t=i!=null?Gi(Xi(i)):{},er(e||!i||!i.__esModule?ns(t,"default",{value:i,enumerable:!0}):t,i));var ie=(i,e,t)=>Zi(i,typeof e!="symbol"?e+"":e,t),ss=(i,e,t)=>e.has(i)||Hs("Cannot "+t);var s=(i,e,t)=>(ss(i,e,"read from private field"),t?t.call(i):e.get(i)),c=(i,e,t)=>e.has(i)?Hs("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),d=(i,e,t,n)=>(ss(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),l=(i,e,t)=>(ss(i,e,"access private method"),t);var is=(i,e,t,n)=>({set _(r){d(i,e,r,t)},get _(){return s(i,e,n)}});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const w=require("./main-BBEoE1HQ.cjs");class mn extends Error{}class j{static serializeNumber(e){let t;return Object.is(e,-0)?t="-0":Object.is(e,1/0)?t="Infinity":Object.is(e,-1/0)?t="-Infinity":Object.is(e,NaN)?t="NaN":t=e,{type:"number",value:t}}static serializeObject(e){if(e===null)return{type:"null"};if(Array.isArray(e))return{type:"array",value:e.map(n=>j.serializeRemoveValue(n))};if(w.isPlainObject(e)){try{JSON.stringify(e)}catch(n){throw n instanceof TypeError&&n.message.startsWith("Converting circular structure to JSON")&&(n.message+=" Recursive objects are not allowed."),n}const t=[];for(const n in e)t.push([j.serializeRemoveValue(n),j.serializeRemoveValue(e[n])]);return{type:"object",value:t}}else{if(w.isRegExp(e))return{type:"regexp",value:{pattern:e.source,flags:e.flags}};if(w.isDate(e))return{type:"date",value:e.toISOString()}}throw new mn("Custom object sterilization not possible. Use plain objects instead.")}static serializeRemoveValue(e){switch(typeof e){case"symbol":case"function":throw new mn(`Unable to serializable ${typeof e}`);case"object":return j.serializeObject(e);case"undefined":return{type:"undefined"};case"number":return j.serializeNumber(e);case"bigint":return{type:"bigint",value:e.toString()};case"string":return{type:"string",value:e};case"boolean":return{type:"boolean",value:e}}}static serialize(e,t){const n=e&&(e instanceof Bs||e instanceof ni)?e:null;if(n){if(n.context()!==t)throw new Error("JSHandles can be evaluated only in the context they were created!");if(n.disposed)throw new Error("JSHandle is disposed!");return n.remoteValue()}return j.serializeRemoveValue(e)}static deserializeNumber(e){switch(e){case"-0":return-0;case"NaN":return NaN;case"Infinity":case"+Infinity":return 1/0;case"-Infinity":return-1/0;default:return e}}static deserializeLocalValue(e){var t;switch(e.type){case"array":return(t=e.value)===null||t===void 0?void 0:t.map(n=>j.deserializeLocalValue(n));case"set":return e.value.reduce((n,r)=>n.add(j.deserializeLocalValue(r)),new Set);case"object":if(e.value)return e.value.reduce((n,r)=>{const{key:o,value:a}=j.deserializeTuple(r);return n[o]=a,n},{});break;case"map":return e.value.reduce((n,r)=>{const{key:o,value:a}=j.deserializeTuple(r);return n.set(o,a)},new Map);case"promise":return{};case"regexp":return new RegExp(e.value.pattern,e.value.flags);case"date":return new Date(e.value);case"undefined":return;case"null":return null;case"number":return j.deserializeNumber(e.value);case"bigint":return BigInt(e.value);case"boolean":return!!e.value;case"string":return e.value}throw new mn(`Deserialization of type ${e.type} not supported.`)}static deserializeTuple([e,t]){const n=typeof e=="string"?e:j.deserializeLocalValue(e),r=j.deserializeLocalValue(t);return{key:n,value:r}}static deserialize(e){if(!e){w.debugError("Service did not produce a result.");return}try{return j.deserializeLocalValue(e)}catch(t){if(t instanceof mn){w.debugError(t.message);return}throw t}}}const nr=w.debug("puppeteer:error");async function sr(i,e){e.handle&&await i.connection.send("script.disown",{target:{context:i._contextId},handles:[e.handle]}).catch(t=>{nr(t)})}var rs=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},B=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Tt,Ae,W;class Bs extends w.JSHandle{constructor(e,t){super(),Tt.set(this,!1),Ae.set(this,void 0),W.set(this,void 0),rs(this,Ae,e,"f"),rs(this,W,t,"f")}context(){return B(this,Ae,"f")}get connection(){return B(this,Ae,"f").connection}get disposed(){return B(this,Tt,"f")}async evaluate(e,...t){return await this.context().evaluate(e,this,...t)}async evaluateHandle(e,...t){return await this.context().evaluateHandle(e,this,...t)}async getProperty(e){return await this.evaluateHandle((t,n)=>t[n],e)}async getProperties(){const e=await this.evaluate(r=>Object.getOwnPropertyNames(r)),t=new Map,n=await Promise.all(e.map(r=>this.getProperty(r)));for(const[r,o]of Object.entries(e)){const a=n[r];a&&t.set(o,a)}return t}async jsonValue(){const e=j.deserialize(B(this,W,"f"));if(B(this,W,"f").type!=="undefined"&&e===void 0)throw new Error("Could not serialize referenced object");return e}asElement(){return null}async dispose(){B(this,Tt,"f")||(rs(this,Tt,!0,"f"),"handle"in B(this,W,"f")&&await sr(B(this,Ae,"f"),B(this,W,"f")))}get isPrimitiveValue(){switch(B(this,W,"f").type){case"string":case"number":case"bigint":case"boolean":case"undefined":case"null":return!0;default:return!1}}toString(){return this.isPrimitiveValue?"JSHandle:"+j.deserialize(B(this,W,"f")):"JSHandle@"+B(this,W,"f").type}get id(){return"handle"in B(this,W,"f")?B(this,W,"f").handle:void 0}remoteValue(){return B(this,W,"f")}}Tt=new WeakMap,Ae=new WeakMap,W=new WeakMap;class ni extends w.ElementHandle{constructor(e,t){super(new Bs(e,t))}context(){return this.handle.context()}get connection(){return this.handle.connection}get isPrimitiveValue(){return this.handle.isPrimitiveValue}remoteValue(){return this.handle.remoteValue()}}var os=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},qe=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Cn,Ge,Mt,fs;const ir=new Map([["load","complete"],["domcontentloaded","interactive"]]),rr=new Map([["load","browsingContext.load"],["domcontentloaded","browsingContext.domContentLoaded"]]);class or extends w.EventEmitter{constructor(e,t){super(),Cn.add(this),Ge.set(this,void 0),Mt.set(this,void 0),this._timeoutSettings=new w.TimeoutSettings,os(this,Ge,e,"f"),this._contextId=t.context,os(this,Mt,t.url,"f")}get connection(){return qe(this,Ge,"f")}get id(){return this._contextId}async evaluateHandle(e,...t){return qe(this,Cn,"m",fs).call(this,!1,e,...t)}async evaluate(e,...t){return qe(this,Cn,"m",fs).call(this,!0,e,...t)}async goto(e,t={}){const{waitUntil:n="load",timeout:r=this._timeoutSettings.navigationTimeout()}=t,o=ir.get(Js(n));try{const a=await w.waitWithTimeout(this.connection.send("browsingContext.navigate",{url:e,context:this.id,wait:o}),"Navigation",r);return os(this,Mt,a.result.url,"f"),null}catch(a){throw a instanceof w.ProtocolError?a.message+=` at ${e}`:a instanceof w.TimeoutError&&(a.message="Navigation timeout of "+r+" ms exceeded"),a}}url(){return qe(this,Mt,"f")}async setContent(e,t={}){const{waitUntil:n="load",timeout:r=this._timeoutSettings.navigationTimeout()}=t,o=rr.get(Js(n));await Promise.all([w.setPageContent(this,e),w.waitWithTimeout(new Promise(a=>{this.once(o,()=>{a()})}),o,r)])}}Ge=new WeakMap,Mt=new WeakMap,Cn=new WeakSet,fs=async function(e,t,...n){let r;const o=e?"none":"root";w.isString(t)?r=qe(this,Ge,"f").send("script.evaluate",{expression:t,target:{context:this._contextId},resultOwnership:o,awaitPromise:!0}):r=qe(this,Ge,"f").send("script.callFunction",{functionDeclaration:w.stringifyFunction(t),arguments:await Promise.all(n.map(p=>j.serialize(p,this))),target:{context:this._contextId},resultOwnership:o,awaitPromise:!0});const{result:a}=await r;if("type"in a&&a.type==="exception")throw new Error(a.exceptionDetails.text);return e?j.deserialize(a.result):si(this,a.result)};function Js(i){if(Array.isArray(i)&&i.length>1)throw new Error("BiDi support only single `waitUntil` argument");const e=Array.isArray(i)?i.find(t=>t==="domcontentloaded"||t==="load"):i;if(e==="networkidle0"||e==="networkidle2")throw new Error(`BiDi does not support 'waitUntil' ${e}`);return w.assert(e,`Invalid waitUntil option ${e}`),e}function si(i,e){return e.type==="node"||e.type==="window"?new ni(i,e):new Bs(i,e)}var ar=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},b=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Rt,_,Be,ii,ri,oi;class ai extends w.Page{constructor(e){super(),Rt.add(this),_.set(this,void 0),Be.set(this,new Map([["log.entryAdded",b(this,Rt,"m",ii).bind(this)],["browsingContext.load",b(this,Rt,"m",ri).bind(this)],["browsingContext.domContentLoaded",b(this,Rt,"m",oi).bind(this)]])),ar(this,_,e,"f"),b(this,_,"f").connection.send("session.subscribe",{events:[...b(this,Be,"f").keys()],contexts:[b(this,_,"f").id]}).catch(t=>{if(w.isErrorLike(t)&&!t.message.includes("Target closed"))throw t});for(const[t,n]of b(this,Be,"f"))b(this,_,"f").on(t,n)}async close(){await b(this,_,"f").connection.send("session.unsubscribe",{events:[...b(this,Be,"f").keys()],contexts:[b(this,_,"f").id]}),await b(this,_,"f").connection.send("browsingContext.close",{context:b(this,_,"f").id});for(const[e,t]of b(this,Be,"f"))b(this,_,"f").off(e,t)}async evaluateHandle(e,...t){return b(this,_,"f").evaluateHandle(e,...t)}async evaluate(e,...t){return b(this,_,"f").evaluate(e,...t)}async goto(e,t){return b(this,_,"f").goto(e,t)}url(){return b(this,_,"f").url()}setDefaultNavigationTimeout(e){b(this,_,"f")._timeoutSettings.setDefaultNavigationTimeout(e)}setDefaultTimeout(e){b(this,_,"f")._timeoutSettings.setDefaultTimeout(e)}async setContent(e,t={}){await b(this,_,"f").setContent(e,t)}async content(){return await this.evaluate(()=>{let e="";return document.doctype&&(e=new XMLSerializer().serializeToString(document.doctype)),document.documentElement&&(e+=document.documentElement.outerHTML),e})}async pdf(e={}){const{path:t=void 0}=e,{printBackground:n,margin:r,landscape:o,width:a,height:p,pageRanges:f,scale:$,preferCSSPageSize:U,timeout:F}=this._getPDFOptions(e,"cm"),{result:_t}=await w.waitWithTimeout(b(this,_,"f").connection.send("browsingContext.print",{context:b(this,_,"f")._contextId,background:n,margin:r,orientation:o?"landscape":"portrait",page:{width:a,height:p},pageRanges:f.split(", "),scale:$,shrinkToFit:!U}),"browsingContext.print",F),wn=Buffer.from(_t.data,"base64");return await this._maybeWriteBufferToFile(t,wn),wn}async createPDFStream(e){const t=await this.pdf(e);try{const{Readable:n}=await import("stream");return n.from(t)}catch(n){throw n instanceof TypeError?new Error("Can only pass a file path in a Node-like environment."):n}}async screenshot(e={}){const{path:t=void 0,encoding:n,...r}=e;if(Object.keys(r).length>=1)throw new Error('BiDi only supports "encoding" and "path" options');const{result:o}=await b(this,_,"f").connection.send("browsingContext.captureScreenshot",{context:b(this,_,"f")._contextId});if(n==="base64")return o.data;const a=Buffer.from(o.data,"base64");return await this._maybeWriteBufferToFile(t,a),a}}_=new WeakMap,Be=new WeakMap,Rt=new WeakSet,ii=function(e){var t;if(cr(e)){const n=e.args.map(o=>si(b(this,_,"f"),o)),r=n.reduce((o,a)=>{const p=a.isPrimitiveValue?j.deserialize(a.remoteValue()):a.toString();return`${o} ${p}`},"").slice(1);this.emit("console",new w.ConsoleMessage(e.method,r,n,dr(e.stackTrace)))}else if(ur(e)){let n=(t=e.text)!==null&&t!==void 0?t:"";if(e.stackTrace)for(const o of e.stackTrace.callFrames){const a=o.url+":"+o.lineNumber+":"+o.columnNumber,p=o.functionName||"<anonymous>";n+=`
    at ${p} (${a})`}const r=new Error(n);r.stack="",this.emit("pageerror",r)}else w.debugError(`Unhandled LogEntry with type "${e.type}", text "${e.text}" and level "${e.level}"`)},ri=function(e){this.emit("load")},oi=function(e){this.emit("domcontentloaded")};function cr(i){return i.type==="console"}function ur(i){return i.type==="javascript"}function dr(i){const e=[];if(i)for(const t of i.callFrames)e.push({url:t.url,lineNumber:t.lineNumber,columnNumber:t.columnNumber});return e}var lr=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Gs=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},jt;class ci extends w.BrowserContext{constructor(e){super(),jt.set(this,void 0),lr(this,jt,e,"f")}async newPage(){const{result:e}=await Gs(this,jt,"f").send("browsingContext.create",{type:"tab"}),t=Gs(this,jt,"f").context(e.context);return new ai(t)}async close(){}}jt=new WeakMap;var as=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},It=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},xn,yn,Le;class Ls extends w.Browser{static async create(e){try{await e.connection.send("session.new",{})}catch{}return await e.connection.send("session.subscribe",{events:["browsingContext.contextCreated"]}),new Ls(e)}constructor(e){super(),xn.set(this,void 0),yn.set(this,void 0),Le.set(this,void 0),as(this,xn,e.process,"f"),as(this,yn,e.closeCallback,"f"),as(this,Le,e.connection,"f")}async close(){var e;It(this,Le,"f").dispose(),await((e=It(this,yn,"f"))===null||e===void 0?void 0:e.call(null))}isConnected(){return!It(this,Le,"f").closed}process(){var e;return(e=It(this,xn,"f"))!==null&&e!==void 0?e:null}async createIncognitoBrowserContext(e){return new ci(It(this,Le,"f"))}}xn=new WeakMap,yn=new WeakMap,Le=new WeakMap;var En=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},S=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},$e,te,Dt,_n,Bt,He,Je,ui,di,ps;const hr=w.debug("puppeteer:webDriverBiDi:SEND ►"),fr=w.debug("puppeteer:webDriverBiDi:RECV ◀");class li extends w.EventEmitter{constructor(e,t=0,n){super(),$e.add(this),te.set(this,void 0),Dt.set(this,void 0),_n.set(this,0),Bt.set(this,!1),He.set(this,new w.CallbackRegistry),Je.set(this,new Map),En(this,Dt,t,"f"),En(this,_n,n??18e4,"f"),En(this,te,e,"f"),S(this,te,"f").onmessage=this.onMessage.bind(this),S(this,te,"f").onclose=S(this,$e,"m",ps).bind(this)}get closed(){return S(this,Bt,"f")}context(e){return S(this,Je,"f").get(e)||null}send(e,t){return S(this,He,"f").create(e,S(this,_n,"f"),n=>{const r=JSON.stringify({id:n,method:e,params:t});hr(r),S(this,te,"f").send(r)})}async onMessage(e){S(this,Dt,"f")&&await new Promise(n=>setTimeout(n,S(this,Dt,"f"))),fr(e);const t=JSON.parse(e);"id"in t?"error"in t?S(this,He,"f").reject(t.id,pr(t),t.message):S(this,He,"f").resolve(t.id,t):(S(this,$e,"m",di).call(this,t),S(this,$e,"m",ui).call(this,t),this.emit(t.method,t.params))}dispose(){S(this,$e,"m",ps).call(this),S(this,te,"f").close()}}te=new WeakMap,Dt=new WeakMap,_n=new WeakMap,Bt=new WeakMap,He=new WeakMap,Je=new WeakMap,$e=new WeakSet,ui=function(e){let t;"context"in e.params&&e.params.context?t=S(this,Je,"f").get(e.params.context):"source"in e.params&&e.params.source.context&&(t=S(this,Je,"f").get(e.params.source.context)),t==null||t.emit(e.method,e.params)},di=function(e){switch(e.method){case"browsingContext.contextCreated":S(this,Je,"f").set(e.params.context,new or(this,e.params))}},ps=function(){S(this,Bt,"f")||(En(this,Bt,!0,"f"),S(this,te,"f").onmessage=void 0,S(this,te,"f").onclose=void 0,S(this,He,"f").clear())};function pr(i){let e=`${i.error} ${i.message}`;return i.stacktrace&&(e+=` ${i.stacktrace}`),e}var Ln={},$n={},yt={},gr=function(i){return{all:i=i||new Map,on:function(e,t){var n=i.get(e);n?n.push(t):i.set(e,[t])},off:function(e,t){var n=i.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var n=i.get(e);n&&n.slice().map(function(r){r(t)}),(n=i.get("*"))&&n.slice().map(function(r){r(e,t)})}}},wr=w.commonjsGlobal&&w.commonjsGlobal.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(yt,"__esModule",{value:!0});yt.EventEmitter=void 0;const mr=wr(gr);var Ke;class vr{constructor(){c(this,Ke,(0,mr.default)())}on(e,t){return s(this,Ke).on(e,t),this}once(e,t){const n=r=>{t(r),this.off(e,n)};return this.on(e,n)}off(e,t){return s(this,Ke).off(e,t),this}emit(e,t){s(this,Ke).emit(e,t)}}Ke=new WeakMap;yt.EventEmitter=vr;var Wn={},fn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.LogType=void 0,function(e){e.bidi="BiDi Messages",e.browsingContexts="Browsing Contexts",e.cdp="CDP",e.system="System"}(i.LogType||(i.LogType={}))})(fn);Object.defineProperty(Wn,"__esModule",{value:!0});Wn.ProcessingQueue=void 0;const br=fn;var Lt,$t,Wt,Qe,Xe,Tn,hi;class Cr{constructor(e,t=()=>Promise.resolve(),n){c(this,Tn);c(this,Lt);c(this,$t);c(this,Wt);c(this,Qe,[]);c(this,Xe,!1);d(this,Lt,t),d(this,Wt,e),d(this,$t,n)}add(e){s(this,Qe).push(e),l(this,Tn,hi).call(this)}}Lt=new WeakMap,$t=new WeakMap,Wt=new WeakMap,Qe=new WeakMap,Xe=new WeakMap,Tn=new WeakSet,hi=async function(){if(!s(this,Xe)){for(d(this,Xe,!0);s(this,Qe).length>0;){const e=s(this,Qe).shift();e!==void 0&&await e.then(t=>s(this,Wt).call(this,t)).catch(t=>{var n;(n=s(this,$t))==null||n.call(this,br.LogType.system,"Event was not processed:",t),s(this,Lt).call(this,t)})}d(this,Xe,!1)}};Wn.ProcessingQueue=Cr;var zn={},V={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.CDP=i.Network=i.Log=i.BrowsingContext=i.Script=i.Message=void 0,function(e){let t;(function(E){E.InvalidArgument="invalid argument",E.InvalidSessionId="invalid session id",E.NoSuchAlert="no such alert",E.NoSuchFrame="no such frame",E.NoSuchHandle="no such handle",E.NoSuchNode="no such node",E.NoSuchScript="no such script",E.SessionNotCreated="session not created",E.UnknownCommand="unknown command",E.UnknownError="unknown error",E.UnsupportedOperation="unsupported operation"})(t=e.ErrorCode||(e.ErrorCode={}));class n{constructor(u,h,g){ie(this,"error");ie(this,"message");ie(this,"stacktrace");this.error=u,this.message=h,this.stacktrace=g}toErrorResponse(u){return{id:u,error:this.error,message:this.message,stacktrace:this.stacktrace}}}e.ErrorResponse=n;class r extends n{constructor(u,h){super(t.InvalidArgument,u,h)}}e.InvalidArgumentException=r;class o extends n{constructor(u,h){super(t.NoSuchHandle,u,h)}}e.NoSuchHandleException=o;class a extends n{constructor(u,h){super(t.InvalidSessionId,u,h)}}e.InvalidSessionIdException=a;class p extends n{constructor(u,h){super(t.NoSuchAlert,u,h)}}e.NoSuchAlertException=p;class f extends n{constructor(u){super(t.NoSuchFrame,u)}}e.NoSuchFrameException=f;class $ extends n{constructor(u,h){super(t.NoSuchNode,u,h)}}e.NoSuchNodeException=$;class U extends n{constructor(u,h){super(t.NoSuchScript,u,h)}}e.NoSuchScriptException=U;class F extends n{constructor(u,h){super(t.SessionNotCreated,u,h)}}e.SessionNotCreatedException=F;class _t extends n{constructor(u,h){super(t.UnknownCommand,u,h)}}e.UnknownCommandException=_t;class wn extends n{constructor(u,h){super(t.UnknownError,u,h)}}e.UnknownErrorException=wn;class ve extends n{constructor(u,h){super(t.UnsupportedOperation,u,h)}}e.UnsupportedOperationException=ve}(i.Message||(i.Message={})),function(e){(function(t){t.MessageEvent="script.message"})(e.EventNames||(e.EventNames={})),e.AllEvents="script"}(i.Script||(i.Script={})),function(e){(function(t){t.LoadEvent="browsingContext.load",t.DomContentLoadedEvent="browsingContext.domContentLoaded",t.ContextCreatedEvent="browsingContext.contextCreated",t.ContextDestroyedEvent="browsingContext.contextDestroyed"})(e.EventNames||(e.EventNames={})),e.AllEvents="browsingContext"}(i.BrowsingContext||(i.BrowsingContext={})),function(e){e.AllEvents="log",function(t){t.LogEntryAddedEvent="log.entryAdded"}(e.EventNames||(e.EventNames={}))}(i.Log||(i.Log={})),function(e){e.AllEvents="network",function(t){t.BeforeRequestSentEvent="network.beforeRequestSent",t.ResponseCompletedEvent="network.responseCompleted",t.FetchErrorEvent="network.fetchError"}(e.EventNames||(e.EventNames={}))}(i.Network||(i.Network={})),function(e){e.AllEvents="cdp",function(t){t.EventReceivedEvent="cdp.eventReceived"}(e.EventNames||(e.EventNames={}))}(i.CDP||(i.CDP={}))})(V);var Vn={},Un={},qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.inchesFromCm=void 0;function xr(i){return i/2.54}qn.inchesFromCm=xr;var Et={};Object.defineProperty(Et,"__esModule",{value:!0});Et.Deferred=void 0;var ei,Ye,oe,zt,Vt;ei=Symbol.toStringTag;class yr{constructor(){c(this,Ye,!1);c(this,oe);c(this,zt,()=>{});c(this,Vt,()=>{});ie(this,ei,"Promise");d(this,oe,new Promise((e,t)=>{d(this,zt,e),d(this,Vt,t)})),s(this,oe).catch(()=>{})}get isFinished(){return s(this,Ye)}then(e,t){return s(this,oe).then(e,t)}catch(e){return s(this,oe).catch(e)}resolve(e){d(this,Ye,!0),s(this,zt).call(this,e)}reject(e){d(this,Ye,!0),s(this,Vt).call(this,e)}finally(e){return s(this,oe).finally(e)}}Ye=new WeakMap,oe=new WeakMap,zt=new WeakMap,Vt=new WeakMap;Et.Deferred=yr;var Hn={},fi={};(function(i){var o,a,pi,f,We,gs,ws,gi,ms;Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptEvaluator=i.SHARED_ID_DIVIDER=void 0;const e=V,t=1,n=0;i.SHARED_ID_DIVIDER="_element_";const ve=class ve{constructor(u){c(this,f);c(this,o);d(this,o,u)}static async stringifyObject(u,h){return(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(C=>String(C)),awaitPromise:!1,arguments:[u],returnByValue:!0,executionContextId:h.executionContextId})).result.value}async serializeCdpObject(u,h,g){var v;const C=l(v=ve,a,pi).call(v,u),m=await g.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(N=>N),awaitPromise:!1,arguments:[C],generateWebDriverValue:!0,executionContextId:g.executionContextId});return g.cdpToBidiValue(m,h)}async scriptEvaluate(u,h,g,C){const m=await u.cdpClient.sendCommand("Runtime.evaluate",{contextId:u.executionContextId,expression:h,awaitPromise:g,generateWebDriverValue:!0});return m.exceptionDetails?{exceptionDetails:await l(this,f,ms).call(this,m.exceptionDetails,n,C,u),type:"exception",realm:u.realmId}:{type:"success",result:u.cdpToBidiValue(m,C),realm:u.realmId}}async callFunction(u,h,g,C,m,v){const N=`(...args)=>{ return _callFunction((
${h}
), args);
      function _callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }}`,G=[await l(this,f,We).call(this,g,u)];G.push(...await Promise.all(C.map(async St=>l(this,f,We).call(this,St,u))));let q;try{q=await u.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:N,awaitPromise:m,arguments:G,generateWebDriverValue:!0,executionContextId:u.executionContextId})}catch(St){throw St.code===-32e3&&["Could not find object with given id","Argument should belong to the same JavaScript world as target object","Invalid remote object id"].includes(St.message)?new e.Message.NoSuchHandleException("Handle was not found."):St}return q.exceptionDetails?{exceptionDetails:await l(this,f,ms).call(this,q.exceptionDetails,t,v,u),type:"exception",realm:u.realmId}:{type:"success",result:u.cdpToBidiValue(q,v),realm:u.realmId}}};o=new WeakMap,a=new WeakSet,pi=function(u){return u.objectId!==void 0?{objectId:u.objectId}:u.unserializableValue!==void 0?{unserializableValue:u.unserializableValue}:{value:u.value}},f=new WeakSet,We=async function(u,h){if("sharedId"in u){const[g,C]=u.sharedId.split(i.SHARED_ID_DIVIDER),m=parseInt(C??"");if(isNaN(m)||m===void 0||g===void 0)throw new e.Message.InvalidArgumentException(`SharedId "${u.sharedId}" should have format "{navigableId}${i.SHARED_ID_DIVIDER}{backendNodeId}".`);if(h.navigableId!==g)throw new e.Message.NoSuchNodeException(`SharedId "${u.sharedId}" belongs to different document. Current document is ${h.navigableId}.`);try{return{objectId:(await h.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:m,executionContextId:h.executionContextId})).object.objectId}}catch(v){throw v.code===-32e3&&v.message==="No node with given id found"?new e.Message.NoSuchNodeException(`SharedId "${u.sharedId}" was not found.`):v}}if("handle"in u)return{objectId:u.handle};switch(u.type){case"undefined":return{unserializableValue:"undefined"};case"null":return{unserializableValue:"null"};case"string":return{value:u.value};case"number":return u.value==="NaN"?{unserializableValue:"NaN"}:u.value==="-0"?{unserializableValue:"-0"}:u.value==="Infinity"?{unserializableValue:"Infinity"}:u.value==="-Infinity"?{unserializableValue:"-Infinity"}:{value:u.value};case"boolean":return{value:!!u.value};case"bigint":return{unserializableValue:`BigInt(${JSON.stringify(u.value)})`};case"date":return{unserializableValue:`new Date(Date.parse(${JSON.stringify(u.value)}))`};case"regexp":return{unserializableValue:`new RegExp(${JSON.stringify(u.value.pattern)}, ${JSON.stringify(u.value.flags)})`};case"map":{const g=await l(this,f,gs).call(this,u.value,h);return{objectId:(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...m)=>{const v=new Map;for(let N=0;N<m.length;N+=2)v.set(m[N],m[N+1]);return v}),awaitPromise:!1,arguments:g,returnByValue:!1,executionContextId:h.executionContextId})).result.objectId}}case"object":{const g=await l(this,f,gs).call(this,u.value,h);return{objectId:(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...m)=>{const v={};for(let N=0;N<m.length;N+=2){const G=m[N];v[G]=m[N+1]}return v}),awaitPromise:!1,arguments:g,returnByValue:!1,executionContextId:h.executionContextId})).result.objectId}}case"array":{const g=await l(this,f,ws).call(this,u.value,h);return{objectId:(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...m)=>m),awaitPromise:!1,arguments:g,returnByValue:!1,executionContextId:h.executionContextId})).result.objectId}}case"set":{const g=await l(this,f,ws).call(this,u.value,h);return{objectId:(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...m)=>new Set(m)),awaitPromise:!1,arguments:g,returnByValue:!1,executionContextId:h.executionContextId})).result.objectId}}case"channel":{const C=(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(()=>{const v=[];let N=null;return{async getMessage(){return await(v.length>0?Promise.resolve():new Promise(q=>{N=q})),v.shift()},sendMessage(G){v.push(G),N!==null&&(N(),N=null)}}}),returnByValue:!1,executionContextId:h.executionContextId,generateWebDriverValue:!1})).result.objectId;return l(this,f,gi).call(this,u,C,h),{objectId:(await h.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(v=>v.sendMessage),arguments:[{objectId:C}],returnByValue:!1,executionContextId:h.executionContextId,generateWebDriverValue:!1})).result.objectId}}default:throw new Error(`Value ${JSON.stringify(u)} is not deserializable.`)}},gs=async function(u,h){const g=[];for(const[C,m]of u){let v;typeof C=="string"?v={value:C}:v=await l(this,f,We).call(this,C,h);const N=await l(this,f,We).call(this,m,h);g.push(v),g.push(N)}return g},ws=async function(u,h){return Promise.all(u.map(g=>l(this,f,We).call(this,g,h)))},gi=async function(u,h,g){const C=u.value.channel;for(;;){const m=await g.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(async v=>v.getMessage()),arguments:[{objectId:h}],awaitPromise:!0,executionContextId:g.executionContextId,generateWebDriverValue:!0});s(this,o).registerEvent({method:e.Script.EventNames.MessageEvent,params:{channel:C,data:g.cdpToBidiValue(m,u.value.ownership??"none"),source:{realm:g.realmId,context:g.browsingContextId}}},g.browsingContextId)}},ms=async function(u,h,g,C){var G;const m=(G=u.stackTrace)==null?void 0:G.callFrames.map(q=>({url:q.url,functionName:q.functionName,lineNumber:q.lineNumber-h,columnNumber:q.columnNumber})),v=await this.serializeCdpObject(u.exception,g,C),N=await ve.stringifyObject(u.exception,C);return{exception:v,columnNumber:u.columnNumber,lineNumber:u.lineNumber-h,stackTrace:{callFrames:m||[]},text:N||u.text}},c(ve,a);let r=ve;i.ScriptEvaluator=r})(fi);Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Realm=void 0;const cs=fi;var ae,be,Ze,et,Ut,qt,Ht,Jt,Gt,Ce;class Er{constructor(e,t,n,r,o,a,p,f,$,U,F){c(this,ae);c(this,be);c(this,Ze);c(this,et);c(this,Ut);c(this,qt);c(this,Ht);c(this,Jt);c(this,Gt);c(this,Ce);ie(this,"sandbox");ie(this,"cdpSessionId");d(this,Ze,n),d(this,et,r),d(this,Ut,o),this.sandbox=f,d(this,qt,a),d(this,Ht,p),this.cdpSessionId=$,d(this,Jt,U),d(this,ae,e),d(this,be,t),d(this,Gt,F),d(this,Ce,new cs.ScriptEvaluator(s(this,Gt))),s(this,ae).realmMap.set(s(this,Ze),this)}async disown(e){if(s(this,ae).knownHandlesToRealm.get(e)===this.realmId){try{await this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:e})}catch(t){if(!(t.code===-32e3&&t.message==="Invalid remote object id"))throw t}s(this,ae).knownHandlesToRealm.delete(e)}}cdpToBidiValue(e,t){const n=e.result.webDriverValue,r=this.webDriverValueToBiDi(n);if(e.result.objectId){const o=e.result.objectId;t==="root"?(r.handle=o,s(this,ae).knownHandlesToRealm.set(o,this.realmId)):this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:o})}return r}webDriverValueToBiDi(e){const t=e;if(t.type==="platformobject")return{type:"object"};const n=t.value;if(n===void 0)return t;if(t.type==="node"&&(Object.hasOwn(n,"backendNodeId")&&(n.sharedId=`${this.navigableId}${cs.SHARED_ID_DIVIDER}${n.backendNodeId}`,delete n.backendNodeId),Object.hasOwn(n,"children")))for(const r in n.children)n.children[r]=this.webDriverValueToBiDi(n.children[r]);if(["array","set"].includes(e.type))for(const r in n)n[r]=this.webDriverValueToBiDi(n[r]);if(["object","map"].includes(e.type))for(const r in n)n[r]=[this.webDriverValueToBiDi(n[r][0]),this.webDriverValueToBiDi(n[r][1])];return t}toBiDi(){return{realm:this.realmId,origin:this.origin,type:this.type,context:this.browsingContextId,...this.sandbox===void 0?{}:{sandbox:this.sandbox}}}get realmId(){return s(this,Ze)}get navigableId(){var e;return((e=s(this,be).findContext(s(this,et)))==null?void 0:e.navigableId)??"UNKNOWN"}get browsingContextId(){return s(this,et)}get executionContextId(){return s(this,Ut)}get origin(){return s(this,qt)}get type(){return s(this,Ht)}get cdpClient(){return s(this,Jt)}async callFunction(e,t,n,r,o){return await s(this,be).getContext(this.browsingContextId).awaitUnblocked(),{result:await s(this,Ce).callFunction(this,e,t,n,r,o)}}async scriptEvaluate(e,t,n){return await s(this,be).getContext(this.browsingContextId).awaitUnblocked(),{result:await s(this,Ce).scriptEvaluate(this,e,t,n)}}async serializeCdpObject(e,t){return s(this,Ce).serializeCdpObject(e,t,this)}async stringifyObject(e){return cs.ScriptEvaluator.stringifyObject(e,this)}}ae=new WeakMap,be=new WeakMap,Ze=new WeakMap,et=new WeakMap,Ut=new WeakMap,qt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Gt=new WeakMap,Ce=new WeakMap;Hn.Realm=Er;Object.defineProperty(Un,"__esModule",{value:!0});Un.BrowsingContextImpl=void 0;const Fe=qn,Pt=V,us=fn,re=Et,_r=Hn;var xe,ye,tt,Ee,M,ne,ce,K,Q,x,nt,_e,A,bs,Cs,xs,wi,ys;const Ws=class Ws{constructor(e,t,n,r,o,a,p){c(this,A);c(this,xe);c(this,ye);c(this,tt,new Map);c(this,Ee);c(this,M,{documentInitialized:new re.Deferred,Page:{navigatedWithinDocument:new re.Deferred,lifecycleEvent:{DOMContentLoaded:new re.Deferred,load:new re.Deferred}}});c(this,ne,"about:blank");c(this,ce);c(this,K);c(this,Q,null);c(this,x);c(this,nt);c(this,_e);d(this,x,e),d(this,K,t),d(this,xe,n),d(this,ye,r),d(this,ce,o),d(this,Ee,a),d(this,_e,p),l(this,A,xs).call(this)}static create(e,t,n,r,o,a,p){const f=new Ws(e,t,n,r,o,a,p);return a.addContext(f),o.registerEvent({method:Pt.BrowsingContext.EventNames.ContextCreatedEvent,params:f.serializeToBidiValue()},f.contextId),f}get navigableId(){return s(this,Q)}delete(){if(l(this,A,bs).call(this),s(this,K).deleteRealms({browsingContextId:this.contextId}),this.parentId!==null){const e=s(this,Ee).getContext(this.parentId);s(e,tt).delete(this.contextId)}s(this,ce).registerEvent({method:Pt.BrowsingContext.EventNames.ContextDestroyedEvent,params:this.serializeToBidiValue()},this.contextId),s(this,Ee).deleteContext(this.contextId)}get contextId(){return s(this,xe)}get parentId(){return s(this,ye)}get children(){return Array.from(s(this,tt).values())}isTopLevelContext(){return s(this,ye)===null}addChild(e){s(this,tt).set(e.contextId,e)}get cdpTarget(){return s(this,x)}updateCdpTarget(e){d(this,x,e),l(this,A,xs).call(this)}get url(){return s(this,ne)}async awaitLoaded(){await s(this,M).Page.lifecycleEvent.load}awaitUnblocked(){return s(this,x).targetUnblocked}async getOrCreateSandbox(e){if(e===void 0||e==="")return s(this,A,Cs);let t=s(this,K).findRealms({browsingContextId:this.contextId,sandbox:e});if(t.length===0&&(await s(this,x).cdpClient.sendCommand("Page.createIsolatedWorld",{frameId:this.contextId,worldName:e}),t=s(this,K).findRealms({browsingContextId:this.contextId,sandbox:e})),t.length!==1)throw Error(`Sandbox ${e} wasn't created.`);return t[0]}serializeToBidiValue(e=0,t=!0){return{context:s(this,xe),url:this.url,children:e>0?this.children.map(n=>n.serializeToBidiValue(e-1,!1)):null,...t?{parent:s(this,ye)}:{}}}async navigate(e,t){await this.awaitUnblocked();const n=await s(this,x).cdpClient.sendCommand("Page.navigate",{url:e,frameId:this.contextId});if(n.errorText)throw new Pt.Message.UnknownErrorException(n.errorText);switch(l(this,A,ys).call(this,n.loaderId),t){case"none":break;case"interactive":n.loaderId===void 0?await s(this,M).Page.navigatedWithinDocument:await s(this,M).Page.lifecycleEvent.DOMContentLoaded;break;case"complete":n.loaderId===void 0?await s(this,M).Page.navigatedWithinDocument:await s(this,M).Page.lifecycleEvent.load;break}return{result:{navigation:n.loaderId||null,url:e}}}async captureScreenshot(){const[,e]=await Promise.all([s(this,x).cdpClient.sendCommand("Page.bringToFront"),s(this,x).cdpClient.sendCommand("Page.captureScreenshot",{})]);return{result:{data:e.data}}}async print(e){var r,o,a,p,f,$,U;const t={printBackground:e.background,landscape:e.orientation==="landscape",pageRanges:((r=e.pageRanges)==null?void 0:r.join(","))??"",scale:e.scale,preferCSSPageSize:!e.shrinkToFit};return(o=e.margin)!=null&&o.bottom&&(t.marginBottom=(0,Fe.inchesFromCm)(e.margin.bottom)),(a=e.margin)!=null&&a.left&&(t.marginLeft=(0,Fe.inchesFromCm)(e.margin.left)),(p=e.margin)!=null&&p.right&&(t.marginRight=(0,Fe.inchesFromCm)(e.margin.right)),(f=e.margin)!=null&&f.top&&(t.marginTop=(0,Fe.inchesFromCm)(e.margin.top)),($=e.page)!=null&&$.height&&(t.paperHeight=(0,Fe.inchesFromCm)(e.page.height)),(U=e.page)!=null&&U.width&&(t.paperWidth=(0,Fe.inchesFromCm)(e.page.width)),{result:{data:(await s(this,x).cdpClient.sendCommand("Page.printToPDF",t)).data}}}async addPreloadScript(e){return{result:{script:(await s(this,x).cdpClient.sendCommand("Page.addScriptToEvaluateOnNewDocument",{source:`(${e.expression})();`,worldName:e.sandbox})).identifier}}}};xe=new WeakMap,ye=new WeakMap,tt=new WeakMap,Ee=new WeakMap,M=new WeakMap,ne=new WeakMap,ce=new WeakMap,K=new WeakMap,Q=new WeakMap,x=new WeakMap,nt=new WeakMap,_e=new WeakMap,A=new WeakSet,bs=function(){this.children.map(e=>e.delete())},Cs=function(){if(s(this,nt)===void 0)throw new Error(`No default realm for browsing context ${s(this,xe)}`);return s(this,nt)},xs=function(){s(this,x).cdpClient.on("Target.targetInfoChanged",e=>{this.contextId===e.targetInfo.targetId&&d(this,ne,e.targetInfo.url)}),s(this,x).cdpClient.on("Page.frameNavigated",e=>{this.contextId===e.frame.id&&(d(this,ne,e.frame.url+(e.frame.urlFragment??"")),l(this,A,bs).call(this))}),s(this,x).cdpClient.on("Page.navigatedWithinDocument",e=>{this.contextId===e.frameId&&(d(this,ne,e.url),s(this,M).Page.navigatedWithinDocument.resolve(e))}),s(this,x).cdpClient.on("Page.lifecycleEvent",e=>{if(this.contextId!==e.frameId)return;const t=new Date().getTime();if(e.name==="init"&&(l(this,A,ys).call(this,e.loaderId),s(this,M).documentInitialized.resolve()),e.name==="commit"){d(this,Q,e.loaderId);return}if(e.loaderId===s(this,Q))switch(e.name){case"DOMContentLoaded":s(this,M).Page.lifecycleEvent.DOMContentLoaded.resolve(e),s(this,ce).registerEvent({method:Pt.BrowsingContext.EventNames.DomContentLoadedEvent,params:{context:this.contextId,navigation:s(this,Q),timestamp:t,url:s(this,ne)}},this.contextId);break;case"load":s(this,M).Page.lifecycleEvent.load.resolve(e),s(this,ce).registerEvent({method:Pt.BrowsingContext.EventNames.LoadEvent,params:{context:this.contextId,navigation:s(this,Q),timestamp:t,url:s(this,ne)}},this.contextId);break}}),s(this,x).cdpClient.on("Runtime.executionContextCreated",e=>{if(e.context.auxData.frameId!==this.contextId||!["default","isolated"].includes(e.context.auxData.type))return;const t=new _r.Realm(s(this,K),s(this,Ee),e.context.uniqueId,this.contextId,e.context.id,l(this,A,wi).call(this,e),"window",e.context.auxData.type==="isolated"?e.context.name:void 0,s(this,x).cdpSessionId,s(this,x).cdpClient,s(this,ce));e.context.auxData.isDefault&&d(this,nt,t)}),s(this,x).cdpClient.on("Runtime.executionContextDestroyed",e=>{s(this,K).deleteRealms({cdpSessionId:s(this,x).cdpSessionId,executionContextId:e.executionContextId})}),s(this,x).cdpClient.on("Runtime.executionContextsCleared",()=>{s(this,K).deleteRealms({cdpSessionId:s(this,x).cdpSessionId})})},wi=function(e){return e.context.auxData.type==="isolated"?s(this,A,Cs).origin:["://",""].includes(e.context.origin)?"null":e.context.origin},ys=function(e){var t,n,r;if(e===void 0||s(this,Q)===e){s(this,M).Page.navigatedWithinDocument.isFinished&&(s(this,M).Page.navigatedWithinDocument=new re.Deferred);return}s(this,M).documentInitialized.isFinished?s(this,M).documentInitialized=new re.Deferred:(t=s(this,_e))==null||t.call(this,us.LogType.browsingContexts,"Document changed"),s(this,M).Page.lifecycleEvent.DOMContentLoaded.isFinished?s(this,M).Page.lifecycleEvent.DOMContentLoaded=new re.Deferred:(n=s(this,_e))==null||n.call(this,us.LogType.browsingContexts,"Document changed"),s(this,M).Page.lifecycleEvent.load.isFinished?s(this,M).Page.lifecycleEvent.load=new re.Deferred:(r=s(this,_e))==null||r.call(this,us.LogType.browsingContexts,"Document changed"),d(this,Q,e)};let vs=Ws;Un.BrowsingContextImpl=vs;var Jn={},Gn={},wt={};Object.defineProperty(wt,"__esModule",{value:!0});wt.getRemoteValuesText=wt.logMessageFormatter=void 0;const mi=["%s","%d","%i","%f","%o","%O","%c"];function vi(i){return mi.some(e=>i.includes(e))}function bi(i){let e="";const t=i[0].value.toString(),n=i.slice(1,void 0),r=t.split(new RegExp(mi.map(o=>`(${o})`).join("|"),"g"));for(const o of r)if(!(o===void 0||o===""))if(vi(o)){const a=n.shift();if(a===void 0)throw new Error(`Less value is provided: "${_s(i,!1)}"`);o==="%s"?e+=$s(a):o==="%d"||o==="%i"?a.type==="bigint"||a.type==="number"||a.type==="string"?e+=parseInt(a.value.toString(),10):e+="NaN":o==="%f"?a.type==="bigint"||a.type==="number"||a.type==="string"?e+=parseFloat(a.value.toString()):e+="NaN":e+=Es(a)}else e+=o;if(n.length>0)throw new Error(`More value is provided: "${_s(i,!1)}"`);return e}wt.logMessageFormatter=bi;function Es(i){var e;if(i.type!=="array"&&i.type!=="bigint"&&i.type!=="date"&&i.type!=="number"&&i.type!=="object"&&i.type!=="string")return $s(i);if(i.type==="bigint")return`${i.value.toString()}n`;if(i.type==="number")return i.value.toString();if(["date","string"].includes(i.type))return JSON.stringify(i.value);if(i.type==="object")return`{${i.value.map(t=>`${JSON.stringify(t[0])}:${Es(t[1])}`).join(",")}}`;if(i.type==="array")return`[${((e=i.value)==null?void 0:e.map(t=>Es(t)).join(","))??""}]`;throw Error(`Invalid value type: ${i.toString()}`)}function $s(i){var e,t;if(!Object.hasOwn(i,"value"))return i.type;switch(i.type){case"string":case"number":case"boolean":case"bigint":return String(i.value);case"regexp":return`/${i.value.pattern}/${i.value.flags??""}`;case"date":return new Date(i.value).toString();case"object":return`Object(${((e=i.value)==null?void 0:e.length)??""})`;case"array":return`Array(${((t=i.value)==null?void 0:t.length)??""})`;case"map":return`Map(${i.value.length})`;case"set":return`Set(${i.value.length})`;case"node":return"node";default:return i.type}}function _s(i,e){const t=i[0];return t?t.type==="string"&&vi(t.value.toString())&&e?bi(i):i.map(n=>$s(n)).join(" "):""}wt.getRemoteValuesText=_s;Object.defineProperty(Gn,"__esModule",{value:!0});Gn.LogManager=void 0;const vn=V,Sr=wt;function Ks(i){const e=i==null?void 0:i.callFrames.map(t=>({columnNumber:t.columnNumber,functionName:t.functionName,lineNumber:t.lineNumber,url:t.url}));return e?{callFrames:e}:void 0}function Ir(i){return["assert","error"].includes(i)?"error":["debug","trace"].includes(i)?"debug":["warn","warning"].includes(i)?"warn":"info"}var st,it,ue,vt,Ci,xi;const zs=class zs{constructor(e,t,n){c(this,vt);c(this,st);c(this,it);c(this,ue);d(this,ue,e),d(this,it,t),d(this,st,n)}static create(e,t,n){var o;const r=new zs(e,t,n);return l(o=r,vt,Ci).call(o),r}};st=new WeakMap,it=new WeakMap,ue=new WeakMap,vt=new WeakSet,Ci=function(){l(this,vt,xi).call(this)},xi=function(){s(this,ue).cdpClient.on("Runtime.consoleAPICalled",e=>{const t=s(this,it).findRealm({cdpSessionId:s(this,ue).cdpSessionId,executionContextId:e.executionContextId}),n=t===void 0?Promise.resolve(e.args):Promise.all(e.args.map(r=>t.serializeCdpObject(r,"none")));s(this,st).registerPromiseEvent(n.then(r=>({method:vn.Log.EventNames.LogEntryAddedEvent,params:{level:Ir(e.type),source:{realm:(t==null?void 0:t.realmId)??"UNKNOWN",context:(t==null?void 0:t.browsingContextId)??"UNKNOWN"},text:(0,Sr.getRemoteValuesText)(r,!0),timestamp:Math.round(e.timestamp),stackTrace:Ks(e.stackTrace),type:"console",method:e.type==="warning"?"warn":e.type,args:r}})),(t==null?void 0:t.browsingContextId)??"UNKNOWN",vn.Log.EventNames.LogEntryAddedEvent)}),s(this,ue).cdpClient.on("Runtime.exceptionThrown",e=>{const t=s(this,it).findRealm({cdpSessionId:s(this,ue).cdpSessionId,executionContextId:e.exceptionDetails.executionContextId}),n=(async()=>e.exceptionDetails.exception?t===void 0?JSON.stringify(e.exceptionDetails.exception):t.stringifyObject(e.exceptionDetails.exception):e.exceptionDetails.text)();s(this,st).registerPromiseEvent(n.then(r=>({method:vn.Log.EventNames.LogEntryAddedEvent,params:{level:"error",source:{realm:(t==null?void 0:t.realmId)??"UNKNOWN",context:(t==null?void 0:t.browsingContextId)??"UNKNOWN"},text:r,timestamp:Math.round(e.timestamp),stackTrace:Ks(e.exceptionDetails.stackTrace),type:"javascript"}})),(t==null?void 0:t.browsingContextId)??"UNKNOWN",vn.Log.EventNames.LogEntryAddedEvent)})};let Ss=zs;Gn.LogManager=Ss;var Kn={},pn={};Object.defineProperty(pn,"__esModule",{value:!0});pn.DefaultMap=void 0;var Kt;class Pr extends Map{constructor(t,n){super(n);c(this,Kt);d(this,Kt,t)}get(t){return this.has(t)||this.set(t,s(this,Kt).call(this,t)),super.get(t)}}Kt=new WeakMap;pn.DefaultMap=Pr;var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.NetworkRequest=void 0;const Qs=Et,Nt=V;var rt,Se,T,de,k,Ie,le,he,P,yi,Ei,Sn,_i,Si,bt,Ii,Pi,Ni,Ti,Mi,Ps;const Z=class Z{constructor(e,t){c(this,P);ie(this,"requestId");c(this,Se);c(this,T);c(this,de);c(this,k);c(this,Ie);c(this,le);c(this,he);this.requestId=e,d(this,Se,t),d(this,le,new Qs.Deferred),d(this,he,new Qs.Deferred)}onRequestWillBeSentEvent(e){if(s(this,T)!==void 0)throw new Error("RequestWillBeSentEvent is already set");d(this,T,e),s(this,de)!==void 0&&s(this,le).resolve(),l(this,P,yi).call(this)}onRequestWillBeSentExtraInfoEvent(e){if(s(this,de)!==void 0)throw new Error("RequestWillBeSentExtraInfoEvent is already set");d(this,de,e),s(this,T)!==void 0&&s(this,le).resolve()}onResponseReceivedEvent(e){if(s(this,k)!==void 0)throw new Error("ResponseReceivedEvent is already set");d(this,k,e),s(this,Ie)!==void 0&&s(this,he).resolve(),l(this,P,Ni).call(this)}onResponseReceivedEventExtraInfo(e){if(s(this,Ie)!==void 0)throw new Error("ResponseReceivedExtraInfoEvent is already set");d(this,Ie,e),s(this,k)!==void 0&&s(this,he).resolve()}onLoadingFailedEvent(e){var n;s(this,le).resolve(),s(this,he).reject(e);const t={...l(this,P,Sn).call(this),errorText:e.errorText};s(this,Se).registerEvent({method:Nt.Network.EventNames.FetchErrorEvent,params:t},((n=s(this,T))==null?void 0:n.frameId)??null)}};rt=new WeakMap,Se=new WeakMap,T=new WeakMap,de=new WeakMap,k=new WeakMap,Ie=new WeakMap,le=new WeakMap,he=new WeakMap,P=new WeakSet,yi=function(){var e;l(this,P,Ps).call(this)||s(this,Se).registerPromiseEvent(s(this,le).then(()=>l(this,P,Ei).call(this)),((e=s(this,T))==null?void 0:e.frameId)??null,Nt.Network.EventNames.BeforeRequestSentEvent)},Ei=function(){if(s(this,T)===void 0)throw new Error("RequestWillBeSentEvent is not set");const e={...l(this,P,Sn).call(this),initiator:{type:l(this,P,Si).call(this)}};return{method:Nt.Network.EventNames.BeforeRequestSentEvent,params:e}},Sn=function(){var e,t,n;return{context:((e=s(this,T))==null?void 0:e.frameId)??null,navigation:((t=s(this,T))==null?void 0:t.loaderId)??null,redirectCount:0,request:l(this,P,_i).call(this),timestamp:Math.round((((n=s(this,T))==null?void 0:n.wallTime)??0)*1e3)}},_i=function(){var t,n,r,o,a;const e=s(this,de)===void 0?[]:l(t=Z,bt,Pi).call(t,s(this,de).associatedCookies);return{request:((n=s(this,T))==null?void 0:n.requestId)??s(Z,rt),url:((r=s(this,T))==null?void 0:r.request.url)??s(Z,rt),method:((o=s(this,T))==null?void 0:o.request.method)??s(Z,rt),headers:Object.keys(((a=s(this,T))==null?void 0:a.request.headers)??[]).map(p=>{var f;return{name:p,value:(f=s(this,T))==null?void 0:f.request.headers[p]}}),cookies:e,headersSize:-1,bodySize:0,timings:{timeOrigin:0,requestTime:0,redirectStart:0,redirectEnd:0,fetchStart:0,dnsStart:0,dnsEnd:0,connectStart:0,connectEnd:0,tlsStart:0,tlsEnd:0,requestStart:0,responseStart:0,responseEnd:0}}},Si=function(){var e;switch((e=s(this,T))==null?void 0:e.initiator.type){case"parser":case"script":case"preflight":return s(this,T).initiator.type;default:return"other"}},bt=new WeakSet,Ii=function(e){switch(e){case"Strict":return"strict";case"Lax":return"lax";default:return"none"}},Pi=function(e){return e.map(t=>{var n;return{name:t.cookie.name,value:t.cookie.value,domain:t.cookie.domain,path:t.cookie.path,expires:t.cookie.expires,size:t.cookie.size,httpOnly:t.cookie.httpOnly,secure:t.cookie.secure,sameSite:l(n=Z,bt,Ii).call(n,t.cookie.sameSite)}})},Ni=function(){var e;l(this,P,Ps).call(this)||s(this,Se).registerPromiseEvent(s(this,he).then(()=>l(this,P,Ti).call(this)),((e=s(this,k))==null?void 0:e.frameId)??null,Nt.Network.EventNames.ResponseCompletedEvent)},Ti=function(){var e,t;if(s(this,k)===void 0)throw new Error("ResponseReceivedEvent is not set");if(s(this,T)===void 0)throw new Error("RequestWillBeSentEvent is not set");return{method:Nt.Network.EventNames.ResponseCompletedEvent,params:{...l(this,P,Sn).call(this),response:{url:s(this,k).response.url,protocol:s(this,k).response.protocol,status:s(this,k).response.status,statusText:s(this,k).response.statusText,fromCache:s(this,k).response.fromDiskCache||s(this,k).response.fromPrefetchCache,headers:l(this,P,Mi).call(this,s(this,k).response.headers),mimeType:s(this,k).response.mimeType,bytesReceived:s(this,k).response.encodedDataLength,headersSize:((t=(e=s(this,Ie))==null?void 0:e.headersText)==null?void 0:t.length)??-1,bodySize:-1,content:{size:-1}}}}},Mi=function(e){return Object.keys(e).map(t=>({name:t,value:e[t]}))},Ps=function(){var e;return((e=s(this,T))==null?void 0:e.request.url.endsWith("/favicon.ico"))??!1},c(Z,bt),c(Z,rt,"UNKNOWN");let Is=Z;Qn.NetworkRequest=Is;Object.defineProperty(Kn,"__esModule",{value:!0});Kn.NetworkProcessor=void 0;const Nr=pn,Tr=Qn;var Qt,Xt,fe,ze;const Vs=class Vs{constructor(e){c(this,fe);c(this,Qt);c(this,Xt);d(this,Qt,e),d(this,Xt,new Nr.DefaultMap(t=>new Tr.NetworkRequest(t,s(this,Qt))))}static async create(e,t){const n=new Vs(t);return e.on("Network.requestWillBeSent",r=>{var o;l(o=n,fe,ze).call(o,r.requestId).onRequestWillBeSentEvent(r)}),e.on("Network.requestWillBeSentExtraInfo",r=>{var o;l(o=n,fe,ze).call(o,r.requestId).onRequestWillBeSentExtraInfoEvent(r)}),e.on("Network.responseReceived",r=>{var o;l(o=n,fe,ze).call(o,r.requestId).onResponseReceivedEvent(r)}),e.on("Network.responseReceivedExtraInfo",r=>{var o;l(o=n,fe,ze).call(o,r.requestId).onResponseReceivedEventExtraInfo(r)}),e.on("Network.loadingFailed",r=>{var o;l(o=n,fe,ze).call(o,r.requestId).onLoadingFailedEvent(r)}),await e.sendCommand("Network.enable"),n}};Qt=new WeakMap,Xt=new WeakMap,fe=new WeakSet,ze=function(e){return s(this,Xt).get(e)};let Ns=Vs;Kn.NetworkProcessor=Ns;Object.defineProperty(Jn,"__esModule",{value:!0});Jn.CdpTarget=void 0;const Mr=Gn,Rr=V,jr=Et,Dr=Kn;var ot,Yt,H,Pe,at,ct,Ct,Ri,ji;const Us=class Us{constructor(e,t,n,r){c(this,Ct);c(this,ot);c(this,Yt);c(this,H);c(this,Pe);c(this,at);c(this,ct);d(this,Yt,e),d(this,H,t),d(this,at,n),d(this,Pe,r),d(this,ct,!1),d(this,ot,new jr.Deferred)}static create(e,t,n,r,o){var p,f;const a=new Us(e,t,n,o);return Mr.LogManager.create(a,r,o),l(p=a,Ct,ji).call(p),l(f=a,Ct,Ri).call(f),a}get targetUnblocked(){return s(this,ot)}get targetId(){return s(this,Yt)}get cdpClient(){return s(this,H)}get cdpSessionId(){return s(this,at)}async enableNetworkDomain(){s(this,ct)||(d(this,ct,!0),await Dr.NetworkProcessor.create(this.cdpClient,s(this,Pe)))}};ot=new WeakMap,Yt=new WeakMap,H=new WeakMap,Pe=new WeakMap,at=new WeakMap,ct=new WeakMap,Ct=new WeakSet,Ri=async function(){s(this,Pe).isNetworkDomainEnabled&&await this.enableNetworkDomain(),await s(this,H).sendCommand("Runtime.enable"),await s(this,H).sendCommand("Page.enable"),await s(this,H).sendCommand("Page.setLifecycleEventsEnabled",{enabled:!0}),await s(this,H).sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),await s(this,H).sendCommand("Runtime.runIfWaitingForDebugger"),s(this,ot).resolve()},ji=function(){s(this,H).on("*",(e,t)=>{s(this,Pe).registerEvent({method:Rr.CDP.EventNames.EventReceivedEvent,params:{cdpMethod:e,cdpParams:t||{},cdpSession:s(this,at)}},null)})};let Ts=Us;Jn.CdpTarget=Ts;Object.defineProperty(Vn,"__esModule",{value:!0});Vn.BrowsingContextProcessor=void 0;const ds=V,Or=fn,Xs=Un,kr=Jn;var y,X,Ne,Te,se,Zt,D,Ms,Di,Oi,ki,Fi,In,Ai;class Fr{constructor(e,t,n,r,o,a){c(this,D);c(this,y);c(this,X);c(this,Ne);c(this,Te);c(this,se);c(this,Zt);d(this,y,o),d(this,X,t),d(this,Ne,r),d(this,Te,a),d(this,se,e),d(this,Zt,n),l(this,D,Ms).call(this,s(this,X).browserClient())}process_browsingContext_getTree(e){return{result:{contexts:(e.root===void 0?s(this,y).getTopLevelContexts():[s(this,y).getContext(e.root)]).map(n=>n.serializeToBidiValue(e.maxDepth??Number.MAX_VALUE))}}}async process_browsingContext_create(e){const t=s(this,X).browserClient();let n;if(e.referenceContext!==void 0&&(n=s(this,y).getContext(e.referenceContext),!n.isTopLevelContext()))throw new ds.Message.InvalidArgumentException("referenceContext should be a top-level context");const o=(await t.sendCommand("Target.createTarget",{url:"about:blank",newWindow:e.type==="window"})).targetId,a=s(this,y).getContext(o);return await a.awaitLoaded(),{result:a.serializeToBidiValue(1)}}process_browsingContext_navigate(e){return s(this,y).getContext(e.context).navigate(e.url,e.wait===void 0?"none":e.wait)}async process_browsingContext_captureScreenshot(e){return s(this,y).getContext(e.context).captureScreenshot()}async process_browsingContext_print(e){return s(this,y).getContext(e.context).print(e)}async process_script_addPreloadScript(e){const t=[],n=[];return e.context?t.push(s(this,y).getContext(e.context)):t.push(...s(this,y).getAllContexts()),n.push(...await Promise.all(t.map(r=>r.addPreloadScript(e)))),n[0]}async process_script_removePreloadScript(e){throw new ds.Message.UnknownErrorException("Not implemented.")}async process_script_evaluate(e){return(await l(this,D,In).call(this,e.target)).scriptEvaluate(e.expression,e.awaitPromise,e.resultOwnership??"none")}process_script_getRealms(e){return e.context!==void 0&&s(this,y).getContext(e.context),{result:{realms:s(this,se).findRealms({browsingContextId:e.context,type:e.type}).map(n=>n.toBiDi())}}}async process_script_callFunction(e){return(await l(this,D,In).call(this,e.target)).callFunction(e.functionDeclaration,e.this||{type:"undefined"},e.arguments||[],e.awaitPromise,e.resultOwnership??"none")}async process_script_disown(e){const t=await l(this,D,In).call(this,e.target);return await Promise.all(e.handles.map(async n=>t.disown(n))),{result:{}}}async process_browsingContext_close(e){const t=s(this,X).browserClient();if(!s(this,y).getContext(e.context).isTopLevelContext())throw new ds.Message.InvalidArgumentException("A top-level browsing context cannot be closed.");const r=new Promise(o=>{const a=p=>{p.targetId===e.context&&(t.off("Target.detachedFromTarget",a),o())};t.on("Target.detachedFromTarget",a)});return await t.sendCommand("Target.closeTarget",{targetId:e.context}),await r,{result:{}}}async process_cdp_sendCommand(e){return{result:await(e.cdpSession?s(this,X).getCdpClient(e.cdpSession):s(this,X).browserClient()).sendCommand(e.cdpMethod,e.cdpParams),cdpSession:e.cdpSession}}process_cdp_getSession(e){const t=e.context,n=s(this,y).getContext(t).cdpTarget.cdpSessionId;return n===void 0?{result:{cdpSession:null}}:{result:{cdpSession:n}}}}y=new WeakMap,X=new WeakMap,Ne=new WeakMap,Te=new WeakMap,se=new WeakMap,Zt=new WeakMap,D=new WeakSet,Ms=function(e){e.on("Target.attachedToTarget",t=>{l(this,D,ki).call(this,t,e)}),e.on("Target.detachedFromTarget",t=>{l(this,D,Fi).call(this,t)}),e.on("Page.frameAttached",t=>{l(this,D,Di).call(this,t)}),e.on("Page.frameDetached",t=>{l(this,D,Oi).call(this,t)})},Di=function(e){const t=s(this,y).findContext(e.parentFrameId);t!==void 0&&Xs.BrowsingContextImpl.create(t.cdpTarget,s(this,se),e.frameId,e.parentFrameId,s(this,Ne),s(this,y),s(this,Te))},Oi=function(e){var t;e.reason!=="swap"&&((t=s(this,y).findContext(e.frameId))==null||t.delete())},ki=function(e,t){var p;const{sessionId:n,targetInfo:r}=e,o=s(this,X).getCdpClient(n);if(!l(this,D,Ai).call(this,r)){o.sendCommand("Runtime.runIfWaitingForDebugger").then(()=>t.sendCommand("Target.detachFromTarget",e));return}(p=s(this,Te))==null||p.call(this,Or.LogType.browsingContexts,"AttachedToTarget event received:",JSON.stringify(e,null,2)),l(this,D,Ms).call(this,o);const a=kr.CdpTarget.create(r.targetId,o,n,s(this,se),s(this,Ne));s(this,y).hasContext(r.targetId)?s(this,y).getContext(r.targetId).updateCdpTarget(a):Xs.BrowsingContextImpl.create(a,s(this,se),r.targetId,null,s(this,Ne),s(this,y),s(this,Te))},Fi=function(e){var n;const t=e.targetId;(n=s(this,y).findContext(t))==null||n.delete()},In=async function(e){return"realm"in e?s(this,se).getRealm({realmId:e.realm}):s(this,y).getContext(e.context).getOrCreateSandbox(e.sandbox)},Ai=function(e){return e.targetId===s(this,Zt)?!1:["page","iframe"].includes(e.type)};Vn.BrowsingContextProcessor=Fr;var gn={};Object.defineProperty(gn,"__esModule",{value:!0});gn.OutgoingBidiMessage=void 0;var en,tn;const Mn=class Mn{constructor(e,t){c(this,en);c(this,tn);d(this,en,e),d(this,tn,t)}static async createFromPromise(e,t){return e.then(n=>new Mn(n,t))}static createResolved(e,t){return Promise.resolve(new Mn(e,t))}get message(){return s(this,en)}get channel(){return s(this,tn)}};en=new WeakMap,tn=new WeakMap;let Rs=Mn;gn.OutgoingBidiMessage=Rs;Object.defineProperty(zn,"__esModule",{value:!0});zn.CommandProcessor=void 0;const bn=V,Ar=fn,Br=yt,Lr=Vn,ls=gn;class $r{parseAddPreloadScriptParams(e){return e}parseRemovePreloadScriptParams(e){return e}parseGetRealmsParams(e){return e}parseCallFunctionParams(e){return e}parseEvaluateParams(e){return e}parseDisownParams(e){return e}parseSendCommandParams(e){return e}parseGetSessionParams(e){return e}parseSubscribeParams(e){return e}parseNavigateParams(e){return e}parseGetTreeParams(e){return e}parseCreateParams(e){return e}parseCloseParams(e){return e}parseCaptureScreenshotParams(e){return e}parsePrintParams(e){return e}}var O,ut,R,nn,Rn,Bi,me,Li,$i,Wi;const jn=class jn extends Br.EventEmitter{constructor(t,n,r,o,a=new $r,p,f){super();c(this,me);c(this,O);c(this,ut);c(this,R);c(this,nn);d(this,ut,r),d(this,nn,f),d(this,O,new Lr.BrowsingContextProcessor(t,n,o,r,p,f)),d(this,R,a)}async processCommand(t){var n;try{const r=await l(this,me,Wi).call(this,t),o={id:t.id,...r};this.emit("response",ls.OutgoingBidiMessage.createResolved(o,t.channel??null))}catch(r){if(r instanceof bn.Message.ErrorResponse){const o=r;this.emit("response",ls.OutgoingBidiMessage.createResolved(o.toErrorResponse(t.id),t.channel??null))}else{const o=r;(n=s(this,nn))==null||n.call(this,Ar.LogType.bidi,o),this.emit("response",ls.OutgoingBidiMessage.createResolved(new bn.Message.ErrorResponse(bn.Message.ErrorCode.UnknownError,o.message).toErrorResponse(t.id),t.channel??null))}}}};O=new WeakMap,ut=new WeakMap,R=new WeakMap,nn=new WeakMap,Rn=new WeakSet,Bi=function(){return{result:{ready:!1,message:"already connected"}}},me=new WeakSet,Li=async function(t,n){return await s(this,ut).subscribe(t.events,t.contexts??[null],n),{result:{}}},$i=async function(t,n){return await s(this,ut).unsubscribe(t.events,t.contexts??[null],n),{result:{}}},Wi=async function(t){var n;switch(t.method){case"session.status":return l(n=jn,Rn,Bi).call(n);case"session.subscribe":return l(this,me,Li).call(this,s(this,R).parseSubscribeParams(t.params),t.channel??null);case"session.unsubscribe":return l(this,me,$i).call(this,s(this,R).parseSubscribeParams(t.params),t.channel??null);case"browsingContext.create":return s(this,O).process_browsingContext_create(s(this,R).parseCreateParams(t.params));case"browsingContext.close":return s(this,O).process_browsingContext_close(s(this,R).parseCloseParams(t.params));case"browsingContext.getTree":return s(this,O).process_browsingContext_getTree(s(this,R).parseGetTreeParams(t.params));case"browsingContext.navigate":return s(this,O).process_browsingContext_navigate(s(this,R).parseNavigateParams(t.params));case"browsingContext.captureScreenshot":return s(this,O).process_browsingContext_captureScreenshot(s(this,R).parseCaptureScreenshotParams(t.params));case"browsingContext.print":return s(this,O).process_browsingContext_print(s(this,R).parsePrintParams(t.params));case"script.addPreloadScript":return s(this,O).process_script_addPreloadScript(s(this,R).parseAddPreloadScriptParams(t.params));case"script.removePreloadScript":return s(this,O).process_script_removePreloadScript(s(this,R).parseRemovePreloadScriptParams(t.params));case"script.getRealms":return s(this,O).process_script_getRealms(s(this,R).parseGetRealmsParams(t.params));case"script.callFunction":return s(this,O).process_script_callFunction(s(this,R).parseCallFunctionParams(t.params));case"script.evaluate":return s(this,O).process_script_evaluate(s(this,R).parseEvaluateParams(t.params));case"script.disown":return s(this,O).process_script_disown(s(this,R).parseDisownParams(t.params));case"cdp.sendCommand":return s(this,O).process_cdp_sendCommand(s(this,R).parseSendCommandParams(t.params));case"cdp.getSession":return s(this,O).process_cdp_getSession(s(this,R).parseGetSessionParams(t.params));default:throw new bn.Message.UnknownCommandException(`Unknown command '${t.method}'.`)}},c(jn,Rn);let js=jn;zn.CommandProcessor=js;var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.BrowsingContextStorage=void 0;const Wr=V;var pe;class zr{constructor(){c(this,pe,new Map)}getTopLevelContexts(){return this.getAllContexts().filter(e=>e.isTopLevelContext())}getAllContexts(){return Array.from(s(this,pe).values())}deleteContext(e){s(this,pe).delete(e)}addContext(e){s(this,pe).set(e.contextId,e),e.isTopLevelContext()||this.getContext(e.parentId).addChild(e)}hasContext(e){return s(this,pe).has(e)}findContext(e){return s(this,pe).get(e)}findTopLevelContextId(e){if(e===null)return null;const t=this.findContext(e),n=(t==null?void 0:t.parentId)??null;return n===null?e:this.findTopLevelContextId(n)}getContext(e){const t=this.findContext(e);if(t===void 0)throw new Wr.Message.NoSuchFrameException(`Context ${e} not found`);return t}}pe=new WeakMap;Xn.BrowsingContextStorage=zr;var Yn={},Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.Buffer=void 0;var sn,Me,rn,ti;let Vr=(ti=class{constructor(e,t=()=>{}){c(this,sn);c(this,Me,[]);c(this,rn);d(this,sn,e),d(this,rn,t)}get(){return s(this,Me)}add(e){for(s(this,Me).push(e);s(this,Me).length>s(this,sn);){const t=s(this,Me).shift();t!==void 0&&s(this,rn).call(this,t)}}},sn=new WeakMap,Me=new WeakMap,rn=new WeakMap,ti);Zn.Buffer=Vr;var es={};Object.defineProperty(es,"__esModule",{value:!0});es.IdWrapper=void 0;var Dn,on;const On=class On{constructor(){c(this,on);d(this,on,++is(On,Dn)._)}get id(){return s(this,on)}};Dn=new WeakMap,on=new WeakMap,c(On,Dn,0);let Ds=On;es.IdWrapper=Ds;var we={};Object.defineProperty(we,"__esModule",{value:!0});we.SubscriptionManager=we.unrollEvents=we.cartesianProduct=void 0;const I=V;function zi(...i){return i.reduce((e,t)=>e.flatMap(n=>t.map(r=>[n,r].flat())))}we.cartesianProduct=zi;function Vi(i){const e=[];for(const t of i)switch(t){case I.BrowsingContext.AllEvents:e.push(...Object.values(I.BrowsingContext.EventNames));break;case I.CDP.AllEvents:e.push(...Object.values(I.CDP.EventNames));break;case I.Log.AllEvents:e.push(...Object.values(I.Log.EventNames));break;case I.Network.AllEvents:e.push(...Object.values(I.Network.EventNames));break;case I.Script.AllEvents:e.push(...Object.values(I.Script.EventNames));break;default:e.push(t)}return e}we.unrollEvents=Vi;var kn,J,ge,xt,Ui,qi;class Ur{constructor(e){c(this,xt);c(this,kn,0);c(this,J,new Map);c(this,ge);d(this,ge,e)}getChannelsSubscribedToEvent(e,t){return Array.from(s(this,J).keys()).map(r=>({priority:l(this,xt,Ui).call(this,e,t,r),channel:r})).filter(({priority:r})=>r!==null).sort((r,o)=>r.priority-o.priority).map(({channel:r})=>r)}subscribe(e,t,n){if(t=s(this,ge).findTopLevelContextId(t),e===I.BrowsingContext.AllEvents){Object.values(I.BrowsingContext.EventNames).map(a=>this.subscribe(a,t,n));return}if(e===I.CDP.AllEvents){Object.values(I.CDP.EventNames).map(a=>this.subscribe(a,t,n));return}if(e===I.Log.AllEvents){Object.values(I.Log.EventNames).map(a=>this.subscribe(a,t,n));return}if(e===I.Network.AllEvents){Object.values(I.Network.EventNames).map(a=>this.subscribe(a,t,n));return}if(e===I.Script.AllEvents){Object.values(I.Script.EventNames).map(a=>this.subscribe(a,t,n));return}s(this,J).has(n)||s(this,J).set(n,new Map);const r=s(this,J).get(n);r.has(t)||r.set(t,new Map);const o=r.get(t);o.has(e)||o.set(e,is(this,kn)._++)}unsubscribeAll(e,t,n){for(const o of t)o!==null&&s(this,ge).getContext(o);zi(Vi(e),t).map(([o,a])=>l(this,xt,qi).call(this,o,a,n)).forEach(o=>o())}unsubscribe(e,t,n){this.unsubscribeAll([e],[t],n)}}kn=new WeakMap,J=new WeakMap,ge=new WeakMap,xt=new WeakSet,Ui=function(e,t,n){const r=s(this,J).get(n);if(r===void 0)return null;const o=s(this,ge).findTopLevelContextId(t),p=[...new Set([null,o])].map(f=>{var $;return($=r.get(f))==null?void 0:$.get(e)}).filter(f=>f!==void 0);return p.length===0?null:Math.min(...p)},qi=function(e,t,n){if(t=s(this,ge).findTopLevelContextId(t),!s(this,J).has(n))throw new I.Message.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);const r=s(this,J).get(n);if(!r.has(t))throw new I.Message.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);const o=r.get(t);if(!o.has(e))throw new I.Message.InvalidArgumentException(`Cannot unsubscribe from ${e}, ${t===null?"null":t}. No subscription found.`);return()=>{o.delete(e),o.size===0&&r.delete(e),r.size===0&&s(this,J).delete(n)}};we.SubscriptionManager=Ur;Object.defineProperty(Yn,"__esModule",{value:!0});Yn.EventManager=void 0;const qr=V,Hr=Zn,Jr=es,Ys=gn,Gr=pn,Kr=we;var an,cn,un;class Qr{constructor(e,t){c(this,an);c(this,cn);c(this,un);d(this,an,new Jr.IdWrapper),d(this,cn,t),d(this,un,e)}get id(){return s(this,an).id}get contextId(){return s(this,cn)}get event(){return s(this,un)}}an=new WeakMap,cn=new WeakMap,un=new WeakMap;const hs=new Map([[qr.Log.EventNames.LogEntryAddedEvent,100]]);var Fn,dn,Re,dt,je,Y,lt,De,Ot,z,Hi,Ji,ks,Fs;const ee=class ee{constructor(e){c(this,z);c(this,dn,new Gr.DefaultMap(()=>new Set));c(this,Re,new Map);c(this,dt,new Map);c(this,je);c(this,Y);c(this,lt);d(this,Y,e),d(this,je,new Kr.SubscriptionManager(e.getBrowsingContextStorage())),d(this,lt,!1)}get isNetworkDomainEnabled(){return s(this,lt)}registerEvent(e,t){this.registerPromiseEvent(Promise.resolve(e),t,e.method)}registerPromiseEvent(e,t,n){const r=new Qr(e,t),o=s(this,je).getChannelsSubscribedToEvent(n,t);l(this,z,Ji).call(this,r,n);for(const a of o)s(this,Y).emitOutgoingMessage(Ys.OutgoingBidiMessage.createFromPromise(e,a)),l(this,z,ks).call(this,r,a,n)}async subscribe(e,t,n){for(const r of t)r!==null&&s(this,Y).getBrowsingContextStorage().getContext(r);for(const r of e)for(const o of t){await l(this,z,Hi).call(this,r,o),s(this,je).subscribe(r,o,n);for(const a of l(this,z,Fs).call(this,r,o,n))s(this,Y).emitOutgoingMessage(Ys.OutgoingBidiMessage.createFromPromise(a.event,n)),l(this,z,ks).call(this,a,n,r)}}unsubscribe(e,t,n){s(this,je).unsubscribeAll(e,t,n)}};Fn=new WeakMap,dn=new WeakMap,Re=new WeakMap,dt=new WeakMap,je=new WeakMap,Y=new WeakMap,lt=new WeakMap,De=new WeakSet,Ot=function(e,t,n){return JSON.stringify({eventName:e,browsingContext:t,channel:n})},z=new WeakSet,Hi=async function(e,t){e.startsWith(s(ee,Fn))&&(t===null?(d(this,lt,!0),await Promise.all(s(this,Y).getBrowsingContextStorage().getAllContexts().map(n=>n.cdpTarget.enableNetworkDomain()))):await s(this,Y).getBrowsingContextStorage().getContext(t).cdpTarget.enableNetworkDomain())},Ji=function(e,t){var r;if(!hs.has(t))return;const n=l(r=ee,De,Ot).call(r,t,e.contextId);s(this,Re).has(n)||s(this,Re).set(n,new Hr.Buffer(hs.get(t))),s(this,Re).get(n).add(e),s(this,dn).get(t).add(e.contextId)},ks=function(e,t,n){var o;if(!hs.has(n))return;const r=l(o=ee,De,Ot).call(o,n,e.contextId,t);s(this,dt).set(r,Math.max(s(this,dt).get(r)??0,e.id))},Fs=function(e,t,n){var f,$,U;const r=l(f=ee,De,Ot).call(f,e,t),o=l($=ee,De,Ot).call($,e,t,n),a=s(this,dt).get(o)??-1/0,p=((U=s(this,Re).get(r))==null?void 0:U.get().filter(F=>F.id>a))??[];return t===null&&Array.from(s(this,dn).get(e).keys()).filter(F=>F!==null&&s(this,Y).getBrowsingContextStorage().hasContext(F)).map(F=>l(this,z,Fs).call(this,e,F,n)).forEach(F=>p.push(...F)),p.sort((F,_t)=>F.id-_t.id)},c(ee,De),c(ee,Fn,"network");let Os=ee;Yn.EventManager=Os;var ts={};Object.defineProperty(ts,"__esModule",{value:!0});ts.RealmStorage=void 0;const Xr=V;var ht,ft;class Yr{constructor(){c(this,ht,new Map);c(this,ft,new Map)}get knownHandlesToRealm(){return s(this,ht)}get realmMap(){return s(this,ft)}findRealms(e){return Array.from(s(this,ft).values()).filter(t=>!(e.realmId!==void 0&&e.realmId!==t.realmId||e.browsingContextId!==void 0&&e.browsingContextId!==t.browsingContextId||e.navigableId!==void 0&&e.navigableId!==t.navigableId||e.executionContextId!==void 0&&e.executionContextId!==t.executionContextId||e.origin!==void 0&&e.origin!==t.origin||e.type!==void 0&&e.type!==t.type||e.sandbox!==void 0&&e.sandbox!==t.sandbox||e.cdpSessionId!==void 0&&e.cdpSessionId!==t.cdpSessionId))}findRealm(e){const t=this.findRealms(e);if(t.length===1)return t[0]}getRealm(e){const t=this.findRealm(e);if(t===void 0)throw new Xr.Message.NoSuchFrameException(`Realm ${JSON.stringify(e)} not found`);return t}deleteRealms(e){this.findRealms(e).map(t=>{s(this,ft).delete(t.realmId),Array.from(s(this,ht).entries()).filter(([,n])=>n===t.realmId).map(([n])=>s(this,ht).delete(n))})}}ht=new WeakMap,ft=new WeakMap;ts.RealmStorage=Yr;Object.defineProperty($n,"__esModule",{value:!0});$n.BidiServer=void 0;const Zr=yt,eo=Wn,to=zn,no=Xn,so=Yn,io=ts;var ln,Oe,pt,ke,hn,gt,An,Bn;const qs=class qs extends Zr.EventEmitter{constructor(t,n,r,o,a){super();c(this,ln);c(this,Oe);c(this,pt);c(this,ke);c(this,hn);c(this,gt);c(this,An,t=>{s(this,pt).processCommand(t)});c(this,Bn,async t=>{const n=t.message;t.channel!==null&&(n.channel=t.channel),await s(this,Oe).sendMessage(n)});d(this,gt,a),d(this,ke,new no.BrowsingContextStorage),d(this,hn,new io.RealmStorage),d(this,ln,new eo.ProcessingQueue(s(this,Bn),()=>Promise.resolve(),s(this,gt))),d(this,Oe,t),s(this,Oe).setOnMessage(s(this,An)),d(this,pt,new to.CommandProcessor(s(this,hn),n,new so.EventManager(this),r,o,s(this,ke),s(this,gt))),s(this,pt).on("response",p=>{this.emitOutgoingMessage(p)})}static async createAndStart(t,n,r,o,a){const p=new qs(t,n,r,o,a),f=n.browserClient();return await f.sendCommand("Target.setDiscoverTargets",{discover:!0}),await f.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),await p.topLevelContextsLoaded(),p}async topLevelContextsLoaded(){await Promise.all(s(this,ke).getTopLevelContexts().map(t=>t.awaitLoaded()))}emitOutgoingMessage(t){s(this,ln).add(t)}close(){s(this,Oe).close()}getBrowsingContextStorage(){return s(this,ke)}};ln=new WeakMap,Oe=new WeakMap,pt=new WeakMap,ke=new WeakMap,hn=new WeakMap,gt=new WeakMap,An=new WeakMap,Bn=new WeakMap;let As=qs;$n.BidiServer=As;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.EventEmitter=i.BidiServer=void 0;var e=$n;Object.defineProperty(i,"BidiServer",{enumerable:!0,get:function(){return e.BidiServer}});var t=yt;Object.defineProperty(i,"EventEmitter",{enumerable:!0,get:function(){return t.EventEmitter}})})(Ln);var mt=function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},L=function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Pn,Ve,kt,Ft,Ue,Nn,At;async function ro(i){const e=new ao,t=new oo(i),n={send(a){e.emitMessage(JSON.parse(a))},close(){o.close(),t.close()},onmessage(a){}};e.on("bidiResponse",a=>{n.onmessage(JSON.stringify(a))});const r=new li(n),o=await Ln.BidiServer.createAndStart(e,t,"");return r}class oo{constructor(e){Pn.set(this,void 0),Ve.set(this,new Map),kt.set(this,void 0),mt(this,Pn,e,"f"),mt(this,kt,new Zs(e),"f")}browserClient(){return L(this,kt,"f")}getCdpClient(e){const t=L(this,Pn,"f").session(e);if(!t)throw new Error("Unknown CDP session with id"+e);if(!L(this,Ve,"f").has(t)){const n=new Zs(t);return L(this,Ve,"f").set(t,n),n}return L(this,Ve,"f").get(t)}close(){L(this,kt,"f").close();for(const e of L(this,Ve,"f").values())e.close()}}Pn=new WeakMap,Ve=new WeakMap,kt=new WeakMap;class Zs extends Ln.EventEmitter{constructor(e){super(),Ft.set(this,!1),Ue.set(this,void 0),Nn.set(this,(t,n)=>{this.emit(t,n)}),mt(this,Ue,e,"f"),L(this,Ue,"f").on("*",L(this,Nn,"f"))}async sendCommand(e,...t){if(!L(this,Ft,"f"))try{return await L(this,Ue,"f").send(e,...t)}catch(n){if(L(this,Ft,"f"))return;throw n}}close(){L(this,Ue,"f").off("*",L(this,Nn,"f")),mt(this,Ft,!0,"f")}}Ft=new WeakMap,Ue=new WeakMap,Nn=new WeakMap;class ao extends Ln.EventEmitter{constructor(){super(...arguments),At.set(this,async e=>{})}emitMessage(e){L(this,At,"f").call(this,e)}setOnMessage(e){mt(this,At,e,"f")}async sendMessage(e){this.emit("bidiResponse",e)}close(){mt(this,At,async e=>{},"f")}}At=new WeakMap;exports.Browser=Ls;exports.BrowserContext=ci;exports.Connection=li;exports.Page=ai;exports.connectBidiOverCDP=ro;
